<svg width="950" height="700" viewBox="0 0 950 700" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <rect x="0" y="0" width="950" height="50" fill="#FF9800"/>
  <text x="475" y="33" font-family="Arial, sans-serif" font-size="22" font-weight="bold" fill="white" text-anchor="middle">Linear / Kernel Attention: O(n²) → O(n)</text>
  
  <!-- The Key Insight -->
  <rect x="30" y="70" width="890" height="120" rx="10" fill="#FFF3E0" stroke="#FF9800" stroke-width="3"/>
  <text x="475" y="100" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#E65100" text-anchor="middle">The Kernel Trick</text>
  
  <text x="50" y="135" font-family="Arial, sans-serif" font-size="12" fill="#333">Standard Attention:</text>
  <text x="250" y="135" font-family="Courier New, monospace" font-size="12" fill="#333">A = softmax(QK^T)V = (exp(QK^T) / Σexp(QK^T)) V</text>
  
  <text x="50" y="165" font-family="Arial, sans-serif" font-size="12" fill="#333">Key Insight:</text>
  <text x="250" y="165" font-family="Courier New, monospace" font-size="12" fill="#E65100">softmax(QK^T) ≈ φ(Q)φ(K)^T for some feature map φ</text>
  
  <!-- Computation Order -->
  <rect x="30" y="210" width="420" height="220" rx="10" fill="#FFEBEE" stroke="#F44336" stroke-width="2"/>
  <text x="240" y="240" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#C62828" text-anchor="middle">Standard: (QK^T)V = O(n²d)</text>
  
  <text x="50" y="275" font-family="Courier New, monospace" font-size="11" fill="#333">Step 1: S = Q @ K.T    # (n,d) @ (d,n) = (n,n)</text>
  <text x="50" y="300" font-family="Courier New, monospace" font-size="11" fill="#333">Step 2: P = softmax(S) # (n,n)</text>
  <text x="50" y="325" font-family="Courier New, monospace" font-size="11" fill="#333">Step 3: O = P @ V      # (n,n) @ (n,d) = (n,d)</text>
  
  <text x="50" y="365" font-family="Arial, sans-serif" font-size="11" fill="#C62828">Bottleneck: n×n matrix multiplication</text>
  <text x="50" y="390" font-family="Arial, sans-serif" font-size="11" fill="#C62828">Time: O(n²d) | Memory: O(n²)</text>
  <text x="50" y="415" font-family="Arial, sans-serif" font-size="11" fill="#666">n=32K, d=128 → ~134 billion ops!</text>
  
  <!-- Linear Attention -->
  <rect x="500" y="210" width="420" height="220" rx="10" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
  <text x="710" y="240" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E7D32" text-anchor="middle">Linear: Q(K^TV) = O(nd²)</text>
  
  <text x="520" y="275" font-family="Courier New, monospace" font-size="11" fill="#333">Step 1: KV = K.T @ V   # (d,n) @ (n,d) = (d,d)</text>
  <text x="520" y="300" font-family="Courier New, monospace" font-size="11" fill="#333">Step 2: O = φ(Q) @ KV  # (n,d) @ (d,d) = (n,d)</text>
  <text x="520" y="325" font-family="Courier New, monospace" font-size="11" fill="#333">(with normalization)</text>
  
  <text x="520" y="365" font-family="Arial, sans-serif" font-size="11" fill="#2E7D32">Key: Reorder multiplication!</text>
  <text x="520" y="390" font-family="Arial, sans-serif" font-size="11" fill="#2E7D32">Time: O(nd²) | Memory: O(nd + d²)</text>
  <text x="520" y="415" font-family="Arial, sans-serif" font-size="11" fill="#666">n=32K, d=128 → ~0.5 billion ops (250x faster!)</text>
  
  <!-- Feature maps -->
  <rect x="30" y="450" width="890" height="230" rx="10" fill="#FAFAFA" stroke="#E0E0E0" stroke-width="2"/>
  <text x="475" y="480" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333" text-anchor="middle">Kernel Feature Maps φ(x)</text>
  
  <!-- Performer -->
  <rect x="50" y="505" width="260" height="155" rx="8" fill="#E3F2FD" stroke="#2196F3" stroke-width="2"/>
  <text x="180" y="530" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#1565C0" text-anchor="middle">Performer (FAVOR+)</text>
  
  <text x="70" y="560" font-family="Courier New, monospace" font-size="10" fill="#333">φ(x) = exp(x·ω - ||x||²/2) / √m</text>
  <text x="70" y="585" font-family="Arial, sans-serif" font-size="10" fill="#666">ω ~ N(0, I), m random features</text>
  <text x="70" y="610" font-family="Arial, sans-serif" font-size="10" fill="#666">Approximates softmax kernel</text>
  <text x="70" y="640" font-family="Arial, sans-serif" font-size="10" fill="#1565C0">exp(q·k) ≈ φ(q)·φ(k)</text>
  
  <!-- Linear Transformer -->
  <rect x="340" y="505" width="260" height="155" rx="8" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2"/>
  <text x="470" y="530" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#2E7D32" text-anchor="middle">Linear Transformer</text>
  
  <text x="360" y="560" font-family="Courier New, monospace" font-size="10" fill="#333">φ(x) = elu(x) + 1</text>
  <text x="360" y="585" font-family="Arial, sans-serif" font-size="10" fill="#666">Simple, non-negative</text>
  <text x="360" y="610" font-family="Arial, sans-serif" font-size="10" fill="#666">elu(x) = x if x > 0</text>
  <text x="360" y="635" font-family="Arial, sans-serif" font-size="10" fill="#666">       = exp(x)-1 otherwise</text>
  
  <!-- ReLU Linear -->
  <rect x="630" y="505" width="260" height="155" rx="8" fill="#F3E5F5" stroke="#9C27B0" stroke-width="2"/>
  <text x="760" y="530" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#7B1FA2" text-anchor="middle">Cosine / ReLU</text>
  
  <text x="650" y="560" font-family="Courier New, monospace" font-size="10" fill="#333">φ(x) = [cos(x), sin(x)]</text>
  <text x="650" y="585" font-family="Arial, sans-serif" font-size="10" fill="#666">or simply:</text>
  <text x="650" y="610" font-family="Courier New, monospace" font-size="10" fill="#333">φ(x) = ReLU(x)</text>
  <text x="650" y="640" font-family="Arial, sans-serif" font-size="10" fill="#666">Non-negative features</text>
</svg>
